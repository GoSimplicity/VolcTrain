<template>
  <Drawer
    v-model:open="visible"
    title="ÁâàÊú¨ÁÆ°ÁêÜ"
    width="900"
    placement="right"
    class="model-version-drawer"
  >
    <div v-if="model" class="drawer-content">
      <!-- ÁâàÊú¨ÁÆ°ÁêÜÂ§¥ÈÉ® -->
      <div class="version-header">
        <div class="model-info">
          <h3>{{ model.name }}</h3>
          <Tag color="blue">ÂΩìÂâçÁâàÊú¨: {{ model.version }}</Tag>
        </div>
        
        <div class="header-actions">
          <Space>
            <Button @click="refreshVersions" :loading="loading">
              <ReloadOutlined />
              Âà∑Êñ∞
            </Button>
            <Button type="primary" @click="showCreateVersionModal">
              <PlusOutlined />
              ÂàõÂª∫Êñ∞ÁâàÊú¨
            </Button>
          </Space>
        </div>
      </div>

      <Divider style="margin: 16px 0" />

      <!-- ÁâàÊú¨ÁªüËÆ° -->
      <Row :gutter="16" class="version-stats">
        <Col :span="6">
          <Card>
            <Statistic
              title="ÊÄªÁâàÊú¨Êï∞"
              :value="versionList.length"
              :value-style="{ color: '#3f8600' }"
              prefix="üì¶"
            />
          </Card>
        </Col>
        <Col :span="6">
          <Card>
            <Statistic
              title="Ê¥ªË∑ÉÁâàÊú¨"
              :value="activeVersionCount"
              :value-style="{ color: '#52c41a' }"
              prefix="‚úÖ"
            />
          </Card>
        </Col>
        <Col :span="6">
          <Card>
            <Statistic
              title="ÊÄª‰∏ãËΩΩÈáè"
              :value="totalDownloads"
              :value-style="{ color: '#1890ff' }"
              prefix="üì•"
            />
          </Card>
        </Col>
        <Col :span="6">
          <Card>
            <Statistic
              title="ÊÄªÂ§ßÂ∞è"
              :value="formatFileSize(totalSize)"
              :value-style="{ color: '#722ed1' }"
              prefix="üíæ"
            />
          </Card>
        </Col>
      </Row>

      <!-- ÁâàÊú¨ÂàóË°® -->
      <Card title="ÁâàÊú¨ÂéÜÂè≤" class="version-list-card">
        <Table
          :columns="versionColumns"
          :data-source="versionList"
          :loading="loading"
          row-key="version"
          :pagination="{ pageSize: 10, size: 'small' }"
        >
          <!-- ÁâàÊú¨‰ø°ÊÅØ -->
          <template #versionInfo="{ record }">
            <div class="version-info">
              <div class="version-header">
                <span class="version-number">{{ record.version }}</span>
                <Tag v-if="record.version === model.version" color="green" size="small">
                  ÂΩìÂâçÁâàÊú¨
                </Tag>
                <Tag v-if="record.isLatest" color="blue" size="small">
                  ÊúÄÊñ∞ÁâàÊú¨
                </Tag>
              </div>
              <div class="version-desc">{{ record.description || 'Êó†ÊèèËø∞' }}</div>
              <div class="version-changelog" v-if="record.changeLog">
                <Text type="secondary" style="font-size: 12px">
                  {{ record.changeLog }}
                </Text>
              </div>
            </div>
          </template>

          <!-- ÊÄßËÉΩÊåáÊ†á -->
          <template #metrics="{ record }">
            <div class="metrics-info">
              <div class="metric-item" v-if="record.accuracy">
                <span class="metric-label">ÂáÜÁ°ÆÁéá:</span>
                <Progress
                  :percent="record.accuracy * 100"
                  size="small"
                  :stroke-color="record.accuracy >= 0.9 ? '#52c41a' : record.accuracy >= 0.8 ? '#faad14' : '#ff4d4f'"
                  style="width: 80px; margin-left: 8px"
                />
                <span class="metric-value">{{ (record.accuracy * 100).toFixed(1) }}%</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Â§ßÂ∞è:</span>
                <span class="metric-value">{{ formatFileSize(record.size) }}</span>
              </div>
            </div>
          </template>

          <!-- ÁªüËÆ°‰ø°ÊÅØ -->
          <template #stats="{ record }">
            <div class="stats-info">
              <div class="stat-item">
                <DownloadOutlined style="margin-right: 4px" />
                {{ record.downloadCount || 0 }}
              </div>
              <div class="stat-item">
                <EyeOutlined style="margin-right: 4px" />
                {{ record.useCount || 0 }}
              </div>
            </div>
          </template>

          <!-- ÂàõÂª∫‰ø°ÊÅØ -->
          <template #creator="{ record }">
            <div class="creator-info">
              <Avatar size="small">{{ record.creatorName?.[0] }}</Avatar>
              <span style="margin-left: 8px">{{ record.creatorName }}</span>
            </div>
          </template>

          <!-- ÂàõÂª∫Êó∂Èó¥ -->
          <template #createTime="{ record }">
            <div class="time-info">
              <div>{{ formatDateTime(record.createTime, 'MM-DD') }}</div>
              <div class="time-detail">{{ formatDateTime(record.createTime, 'HH:mm') }}</div>
            </div>
          </template>

          <!-- Êìç‰Ωú -->
          <template #action="{ record }">
            <Space size="small">
              <Tooltip title="‰∏ãËΩΩÁâàÊú¨">
                <Button type="text" size="small" @click="downloadVersion(record)">
                  <DownloadOutlined />
                </Button>
              </Tooltip>
              <Tooltip title="Êü•ÁúãËØ¶ÊÉÖ">
                <Button type="text" size="small" @click="viewVersionDetail(record)">
                  <EyeOutlined />
                </Button>
              </Tooltip>
              <Tooltip title="ÊØîËæÉÁâàÊú¨">
                <Button type="text" size="small" @click="compareVersion(record)">
                  <DiffOutlined />
                </Button>
              </Tooltip>
              <Dropdown>
                <Button type="text" size="small">
                  <MoreOutlined />
                </Button>
                <template #overlay>
                  <Menu>
                    <Menu.Item 
                      @click="setAsActive(record)"
                      :disabled="record.version === model.version"
                    >
                      <CheckOutlined />
                      ËÆæ‰∏∫ÂΩìÂâçÁâàÊú¨
                    </Menu.Item>
                    <Menu.Item @click="editVersion(record)">
                      <EditOutlined />
                      ÁºñËæë‰ø°ÊÅØ
                    </Menu.Item>
                    <Menu.Item 
                      @click="deleteVersion(record)" 
                      danger
                      :disabled="record.version === model.version"
                    >
                      <DeleteOutlined />
                      Âà†Èô§ÁâàÊú¨
                    </Menu.Item>
                  </Menu>
                </template>
              </Dropdown>
            </Space>
          </template>
        </Table>
      </Card>
    </div>

    <!-- ÂàõÂª∫Êñ∞ÁâàÊú¨Ê®°ÊÄÅÊ°Ü -->
    <Modal
      v-model:open="createVersionModalVisible"
      title="ÂàõÂª∫Êñ∞ÁâàÊú¨"
      width="600px"
      @ok="handleCreateVersionSubmit"
      @cancel="handleCreateVersionCancel"
      :confirm-loading="createVersionLoading"
    >
      <Form
        ref="createVersionFormRef"
        :model="createVersionForm"
        :rules="createVersionFormRules"
        layout="vertical"
      >
        <Form.Item label="ÁâàÊú¨Âè∑" name="version">
          <Input v-model:value="createVersionForm.version" placeholder="‰æãÂ¶Ç: v1.1.0" />
        </Form.Item>

        <Form.Item label="ÁâàÊú¨ÊèèËø∞" name="description">
          <Input v-model:value="createVersionForm.description" placeholder="ÁÆÄË¶ÅÊèèËø∞Ëøô‰∏™ÁâàÊú¨ÁöÑÁâπÁÇπ" />
        </Form.Item>

        <Form.Item label="Êõ¥Êñ∞Êó•Âøó" name="changeLog">
          <Input.TextArea
            v-model:value="createVersionForm.changeLog"
            placeholder="ËØ¶ÁªÜÊèèËø∞Êú¨ÁâàÊú¨ÁöÑÊõ¥Êñ∞ÂÜÖÂÆπ„ÄÅ‰øÆÂ§çÁöÑÈóÆÈ¢òÁ≠â"
            :rows="4"
          />
        </Form.Item>

        <Form.Item label="Ê®°ÂûãÊñá‰ª∂" required>
          <Upload
            :before-upload="beforeUpload"
            :file-list="createVersionForm.file ? [{ uid: '1', name: createVersionForm.file.name, status: 'done' }] : []"
            accept=".h5,.pkl,.pth,.pt,.onnx,.pb,.tflite,.tar.gz,.zip"
          >
            <Button>
              <UploadOutlined />
              ÈÄâÊã©Êñá‰ª∂
            </Button>
            <div style="margin-top: 8px; color: #999; font-size: 12px">
              ÊîØÊåÅÊ†ºÂºè: .h5, .pkl, .pth, .pt, .onnx, .pb, .tflite, .tar.gz, .zip
            </div>
          </Upload>
        </Form.Item>

        <Row :gutter="16">
          <Col :span="12">
            <Form.Item label="ÂáÜÁ°ÆÁéá" name="accuracy">
              <InputNumber
                v-model:value="createVersionForm.accuracy"
                :min="0"
                :max="1"
                :step="0.001"
                :precision="3"
                placeholder="0.000"
                style="width: 100%"
              />
            </Form.Item>
          </Col>
        </Row>

        <Form.Item label="Ë∂ÖÂèÇÊï∞ÈÖçÁΩÆ" name="hyperParameters">
          <Input.TextArea
            v-model:value="createVersionForm.hyperParametersText"
            placeholder='JSONÊ†ºÂºèÔºå‰æãÂ¶Ç: {"learning_rate": 0.001, "batch_size": 32}'
            :rows="4"
          />
        </Form.Item>
      </Form>
    </Modal>

    <!-- ÁâàÊú¨ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <Modal
      v-model:open="versionDetailModalVisible"
      title="ÁâàÊú¨ËØ¶ÊÉÖ"
      width="800px"
      :footer="null"
    >
      <div v-if="selectedVersion" class="version-detail">
        <Descriptions :column="2" bordered>
          <Descriptions.Item label="ÁâàÊú¨Âè∑">
            {{ selectedVersion.version }}
          </Descriptions.Item>
          <Descriptions.Item label="Áä∂ÊÄÅ">
            <Tag v-if="selectedVersion.version === model.version" color="green">
              ÂΩìÂâçÁâàÊú¨
            </Tag>
            <Tag v-else color="default">
              ÂéÜÂè≤ÁâàÊú¨
            </Tag>
          </Descriptions.Item>
          <Descriptions.Item label="Êñá‰ª∂Â§ßÂ∞è">
            {{ formatFileSize(selectedVersion.size) }}
          </Descriptions.Item>
          <Descriptions.Item label="ÂáÜÁ°ÆÁéá" v-if="selectedVersion.accuracy">
            <Progress
              :percent="selectedVersion.accuracy * 100"
              size="small"
              :stroke-color="selectedVersion.accuracy >= 0.9 ? '#52c41a' : selectedVersion.accuracy >= 0.8 ? '#faad14' : '#ff4d4f'"
              style="width: 120px"
            />
            {{ (selectedVersion.accuracy * 100).toFixed(1) }}%
          </Descriptions.Item>
          <Descriptions.Item label="‰∏ãËΩΩÊ¨°Êï∞">
            {{ selectedVersion.downloadCount || 0 }}
          </Descriptions.Item>
          <Descriptions.Item label="‰ΩøÁî®Ê¨°Êï∞">
            {{ selectedVersion.useCount || 0 }}
          </Descriptions.Item>
          <Descriptions.Item label="ÂàõÂª∫ËÄÖ">
            <div class="creator-info">
              <Avatar size="small">{{ selectedVersion.creatorName?.[0] }}</Avatar>
              <span style="margin-left: 8px">{{ selectedVersion.creatorName }}</span>
            </div>
          </Descriptions.Item>
          <Descriptions.Item label="ÂàõÂª∫Êó∂Èó¥">
            {{ formatDateTime(selectedVersion.createTime) }}
          </Descriptions.Item>
          <Descriptions.Item label="ÊèèËø∞" :span="2">
            {{ selectedVersion.description || 'Êó†ÊèèËø∞' }}
          </Descriptions.Item>
          <Descriptions.Item label="Êõ¥Êñ∞Êó•Âøó" :span="2">
            <div class="changelog-content">
              {{ selectedVersion.changeLog || 'Êó†Êõ¥Êñ∞Êó•Âøó' }}
            </div>
          </Descriptions.Item>
        </Descriptions>

        <!-- Ë∂ÖÂèÇÊï∞‰ø°ÊÅØ -->
        <Card title="Ë∂ÖÂèÇÊï∞ÈÖçÁΩÆ" style="margin-top: 16px" v-if="selectedVersion.hyperParameters">
          <pre class="hyperparams-display">{{ JSON.stringify(selectedVersion.hyperParameters, null, 2) }}</pre>
        </Card>
      </div>
    </Modal>
  </Drawer>
</template>

<script lang="ts" setup>
import { ref, reactive, computed, onMounted } from 'vue';
import {
  Drawer,
  Space,
  Button,
  Divider,
  Row,
  Col,
  Card,
  Statistic,
  Table,
  Tag,
  Progress,
  Avatar,
  Tooltip,
  Dropdown,
  Menu,
  Modal,
  Form,
  Input,
  InputNumber,
  Upload,
  Descriptions,
  Typography,
  message,
} from 'ant-design-vue';
import {
  ReloadOutlined,
  PlusOutlined,
  DownloadOutlined,
  EyeOutlined,
  DiffOutlined,
  MoreOutlined,
  CheckOutlined,
  EditOutlined,
  DeleteOutlined,
  UploadOutlined,
} from '@ant-design/icons-vue';
import type { Model } from '#/api/types';
import { formatDateTime, formatFileSize } from '#/utils/date';

const { Text } = Typography;

const props = defineProps<{
  visible: boolean;
  model: Model | null;
}>();

const emit = defineEmits<{
  'update:visible': [value: boolean];
}>();

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const loading = ref(false);
const createVersionModalVisible = ref(false);
const versionDetailModalVisible = ref(false);
const createVersionLoading = ref(false);
const versionList = ref<any[]>([]);
const selectedVersion = ref<any>(null);

// ÂàõÂª∫ÁâàÊú¨Ë°®Âçï
interface CreateVersionForm {
  version: string;
  description: string;
  changeLog: string;
  accuracy: number | null;
  hyperParametersText: string;
  file: File | null;
}

const createVersionForm = reactive<CreateVersionForm>({
  version: '',
  description: '',
  changeLog: '',
  accuracy: null,
  hyperParametersText: '',
  file: null,
});

const createVersionFormRef = ref();

// Ê®°ÊãüÁâàÊú¨Êï∞ÊçÆ
const mockVersions = [
  {
    version: 'v1.2.0',
    description: 'ÊîπËøõÂáÜÁ°ÆÁéáÂíåÊÄßËÉΩ',
    changeLog: '- ‰ºòÂåñÊ®°ÂûãÊû∂ÊûÑ\n- ÊèêÂçáÂáÜÁ°ÆÁéáÂà∞95%\n- ÂáèÂ∞ëÊ®°ÂûãÂ§ßÂ∞è',
    size: 412000000,
    accuracy: 0.95,
    downloadCount: 1258,
    useCount: 89,
    isLatest: true,
    creatorId: 'user-001',
    creatorName: 'Âº†‰∏â',
    createTime: '2024-01-20 14:20:00',
    hyperParameters: {
      'learning_rate': 0.00005,
      'batch_size': 32,
      'epochs': 10,
    },
  },
  {
    version: 'v1.1.0',
    description: '‰øÆÂ§çËÆ≠ÁªÉÁ®≥ÂÆöÊÄßÈóÆÈ¢ò',
    changeLog: '- ‰øÆÂ§çÊ¢ØÂ∫¶ÁàÜÁÇ∏ÈóÆÈ¢ò\n- ÊîπËøõÊï∞ÊçÆÈ¢ÑÂ§ÑÁêÜ\n- Â¢ûÂä†Ê≠£ÂàôÂåñ',
    size: 420000000,
    accuracy: 0.92,
    downloadCount: 856,
    useCount: 67,
    isLatest: false,
    creatorId: 'user-001',
    creatorName: 'Âº†‰∏â',
    createTime: '2024-01-18 10:15:00',
    hyperParameters: {
      'learning_rate': 0.0001,
      'batch_size': 32,
      'epochs': 8,
    },
  },
  {
    version: 'v1.0.0',
    description: 'ÂàùÂßãÁâàÊú¨',
    changeLog: '- Âü∫Á°ÄÊ®°ÂûãÂÆûÁé∞\n- ÊîØÊåÅ‰∏≠ÊñáËØ≠Êñô\n- Âü∫Êú¨ÂäüËÉΩÂÆåÊï¥',
    size: 408000000,
    accuracy: 0.89,
    downloadCount: 234,
    useCount: 45,
    isLatest: false,
    creatorId: 'user-001',
    creatorName: 'Âº†‰∏â',
    createTime: '2024-01-15 10:30:00',
    hyperParameters: {
      'learning_rate': 0.0002,
      'batch_size': 16,
      'epochs': 5,
    },
  },
];

// Ë°®Ê†ºÂàóÂÆö‰πâ
const versionColumns = [
  {
    title: 'ÁâàÊú¨‰ø°ÊÅØ',
    key: 'versionInfo',
    slots: { customRender: 'versionInfo' },
    width: 200,
  },
  {
    title: 'ÊÄßËÉΩÊåáÊ†á',
    key: 'metrics',
    slots: { customRender: 'metrics' },
    width: 180,
  },
  {
    title: 'ÁªüËÆ°',
    key: 'stats',
    slots: { customRender: 'stats' },
    width: 100,
  },
  {
    title: 'ÂàõÂª∫ËÄÖ',
    key: 'creator',
    slots: { customRender: 'creator' },
    width: 120,
  },
  {
    title: 'ÂàõÂª∫Êó∂Èó¥',
    key: 'createTime',
    slots: { customRender: 'createTime' },
    width: 120,
  },
  {
    title: 'Êìç‰Ωú',
    key: 'action',
    slots: { customRender: 'action' },
    width: 150,
    fixed: 'right' as const,
  },
];

// ËÆ°ÁÆóÂ±ûÊÄß
const activeVersionCount = computed(() => {
  return versionList.value.length; // ÁÆÄÂåñÂ§ÑÁêÜÔºåÊâÄÊúâÁâàÊú¨ÈÉΩÁÆóÊ¥ªË∑É
});

const totalDownloads = computed(() => {
  return versionList.value.reduce((sum, version) => sum + (version.downloadCount || 0), 0);
});

const totalSize = computed(() => {
  return versionList.value.reduce((sum, version) => sum + version.size, 0);
});

// Êï∞ÊçÆÂä†ËΩΩ
const loadVersions = async () => {
  if (!props.model) return;
  
  try {
    loading.value = true;
    // const response = await getModelVersions(props.model.id);
    // versionList.value = response.data.items;
    
    // Ê®°ÊãüAPIË∞ÉÁî®
    await new Promise(resolve => setTimeout(resolve, 500));
    versionList.value = mockVersions;
  } catch (error) {
    message.error('Âä†ËΩΩÁâàÊú¨ÂàóË°®Â§±Ë¥•');
  } finally {
    loading.value = false;
  }
};

const refreshVersions = () => {
  loadVersions();
};

// ‰∫ã‰ª∂Â§ÑÁêÜ
const showCreateVersionModal = () => {
  createVersionModalVisible.value = true;
  resetCreateVersionForm();
};

const resetCreateVersionForm = () => {
  Object.assign(createVersionForm, {
    version: '',
    description: '',
    changeLog: '',
    accuracy: null,
    hyperParametersText: '',
    file: null,
  });
};

const beforeUpload = (file: File) => {
  createVersionForm.file = file;
  return false; // ÈòªÊ≠¢Ëá™Âä®‰∏ä‰º†
};

const handleCreateVersionSubmit = async () => {
  try {
    await createVersionFormRef.value?.validate();
    
    if (!createVersionForm.file) {
      message.error('ËØ∑ÈÄâÊã©Ê®°ÂûãÊñá‰ª∂');
      return;
    }
    
    createVersionLoading.value = true;
    
    // Ëß£ÊûêË∂ÖÂèÇÊï∞
    let hyperParameters = null;
    if (createVersionForm.hyperParametersText.trim()) {
      try {
        hyperParameters = JSON.parse(createVersionForm.hyperParametersText);
      } catch (error) {
        message.error('Ë∂ÖÂèÇÊï∞Ê†ºÂºèÈîôËØØÔºåËØ∑‰ΩøÁî®ÊúâÊïàÁöÑJSONÊ†ºÂºè');
        return;
      }
    }
    
    // const request = {
    //   version: createVersionForm.version,
    //   description: createVersionForm.description,
    //   changeLog: createVersionForm.changeLog,
    //   file: createVersionForm.file,
    //   accuracy: createVersionForm.accuracy,
    //   hyperParameters,
    // };
    
    // const response = await createModelVersion(props.model!.id, request);
    
    // Ê®°ÊãüÂàõÂª∫ÊàêÂäü
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    message.success('Êñ∞ÁâàÊú¨ÂàõÂª∫ÊàêÂäü');
    createVersionModalVisible.value = false;
    loadVersions();
  } catch (error) {
    message.error('ÂàõÂª∫Â§±Ë¥•');
  } finally {
    createVersionLoading.value = false;
  }
};

const handleCreateVersionCancel = () => {
  createVersionModalVisible.value = false;
};

const downloadVersion = async (version: any) => {
  try {
    // await downloadModel(props.model!.id, version.version);
    message.success(`ÁâàÊú¨ ${version.version} ‰∏ãËΩΩ‰∏≠...`);
  } catch (error) {
    message.error('‰∏ãËΩΩÂ§±Ë¥•');
  }
};

const viewVersionDetail = (version: any) => {
  selectedVersion.value = version;
  versionDetailModalVisible.value = true;
};

const compareVersion = (version: any) => {
  message.info('ÁâàÊú¨ÊØîËæÉÂäüËÉΩÂºÄÂèë‰∏≠');
};

const setAsActive = async (version: any) => {
  Modal.confirm({
    title: 'Á°ÆËÆ§ÂàáÊç¢ÁâàÊú¨',
    content: `Á°ÆÂÆöË¶ÅÂ∞ÜÁâàÊú¨ ${version.version} ËÆæÁΩÆ‰∏∫ÂΩìÂâçÊ¥ªË∑ÉÁâàÊú¨ÂêóÔºü`,
    okText: 'Á°ÆËÆ§',
    cancelText: 'ÂèñÊ∂à',
    onOk: async () => {
      try {
        // await setActiveModelVersion(props.model!.id, version.version);
        message.success('ÁâàÊú¨ÂàáÊç¢ÊàêÂäü');
        loadVersions();
      } catch (error) {
        message.error('ÁâàÊú¨ÂàáÊç¢Â§±Ë¥•');
      }
    },
  });
};

const editVersion = (version: any) => {
  message.info('ÁºñËæëÁâàÊú¨ÂäüËÉΩÂºÄÂèë‰∏≠');
};

const deleteVersion = async (version: any) => {
  Modal.confirm({
    title: 'Á°ÆËÆ§Âà†Èô§ÁâàÊú¨',
    content: `Á°ÆÂÆöË¶ÅÂà†Èô§ÁâàÊú¨ ${version.version} ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`,
    okText: 'Á°ÆËÆ§',
    cancelText: 'ÂèñÊ∂à',
    onOk: async () => {
      try {
        // await deleteModelVersion(props.model!.id, version.version);
        message.success('ÁâàÊú¨Âà†Èô§ÊàêÂäü');
        loadVersions();
      } catch (error) {
        message.error('ÁâàÊú¨Âà†Èô§Â§±Ë¥•');
      }
    },
  });
};

// Ë°®ÂçïÈ™åËØÅËßÑÂàô
const createVersionFormRules = {
  version: [
    { required: true, message: 'ËØ∑ËæìÂÖ•ÁâàÊú¨Âè∑', trigger: 'blur' },
    { pattern: /^v?\d+\.\d+\.\d+$/, message: 'ÁâàÊú¨Âè∑Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºå‰æãÂ¶Ç: v1.0.0 Êàñ 1.0.0', trigger: 'blur' },
  ],
  changeLog: [
    { required: true, message: 'ËØ∑ËæìÂÖ•Êõ¥Êñ∞Êó•Âøó', trigger: 'blur' },
  ],
};

// ÁõëÂê¨Ê®°ÂûãÂèòÂåñ
import { watch } from 'vue';
watch(() => props.model, (newModel) => {
  if (newModel && props.visible) {
    loadVersions();
  }
});

// ÁõëÂê¨visibleÂèòÂåñ
watch(() => props.visible, (newVal) => {
  if (newVal && props.model) {
    loadVersions();
  }
});

// ÂàùÂßãÂåñ
onMounted(() => {
  if (props.visible && props.model) {
    loadVersions();
  }
});
</script>

<style scoped lang="scss">
.model-version-drawer {
  :deep(.ant-drawer-body) {
    padding: 0;
    display: flex;
    flex-direction: column;
  }
}

.drawer-content {
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 24px;
  overflow-y: auto;
}

.version-header {
  flex-shrink: 0;
  
  .model-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    
    h3 {
      margin: 0;
      color: #1890ff;
    }
  }
  
  .header-actions {
    display: flex;
    justify-content: flex-end;
  }
}

.version-stats {
  margin-bottom: 24px;
  
  .ant-statistic {
    text-align: center;
  }
}

.version-list-card {
  flex: 1;
  
  :deep(.ant-card-head) {
    background: #fafafa;
  }
  
  :deep(.ant-card-head-title) {
    font-weight: 600;
    color: #1890ff;
    font-size: 14px;
  }
}

.version-info {
  .version-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
    
    .version-number {
      font-weight: 600;
      color: #1890ff;
      font-family: 'Monaco', 'Consolas', monospace;
    }
  }
  
  .version-desc {
    color: #666;
    font-size: 12px;
    margin-bottom: 4px;
  }
  
  .version-changelog {
    font-size: 11px;
    max-width: 180px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
}

.metrics-info {
  .metric-item {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
    
    .metric-label {
      font-size: 12px;
      color: #666;
      min-width: 50px;
    }
    
    .metric-value {
      font-size: 12px;
      font-weight: 500;
      margin-left: 8px;
    }
  }
}

.stats-info {
  .stat-item {
    display: flex;
    align-items: center;
    font-size: 12px;
    margin-bottom: 4px;
    color: #666;
  }
}

.creator-info {
  display: flex;
  align-items: center;
  
  span {
    font-size: 12px;
  }
}

.time-info {
  .time-detail {
    font-size: 12px;
    color: #999;
    margin-top: 2px;
  }
}

.version-detail {
  .creator-info {
    display: flex;
    align-items: center;
  }
  
  .changelog-content {
    white-space: pre-wrap;
    color: #666;
    line-height: 1.5;
  }
}

.hyperparams-display {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 6px;
  font-family: 'Monaco', 'Consolas', monospace;
  font-size: 12px;
  line-height: 1.4;
  overflow-x: auto;
}

// ÂìçÂ∫îÂºèËÆæËÆ°
@media (max-width: 768px) {
  .drawer-content {
    padding: 16px;
  }
  
  .version-header {
    .model-info {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    
    .header-actions {
      justify-content: flex-start;
      margin-top: 12px;
    }
  }
  
  .version-stats {
    :deep(.ant-col) {
      margin-bottom: 12px;
    }
  }
}
</style>